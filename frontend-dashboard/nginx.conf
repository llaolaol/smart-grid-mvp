server {
    listen 80;  # 改为不冲突的端口，避免和系统服务冲突
    server_name localhost;

    # 前端静态文件根目录
    root /usr/share/nginx/html;
    index index.html;

    # SPA 支持：所有前端路由 fallback 到 index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 关键：将 API 请求重定向到本地 JSON 文件
    location = /api/devices {
        # 忽略查询参数（如 ?granularity=day），统一返回同一份 mock 数据
        # 如果你需要区分不同参数，可进一步用 if 或 map 处理
        alias /usr/share/nginx/html/api/devices.json;
        add_header Content-Type application/json;
    }
    location = /api/available_years {
        alias /usr/share/nginx/html/api/available_years.json;
        add_header Content-Type application/json;
    }
    location = /api/operation_data {
        alias /usr/share/nginx/html/api/operation_data_granularity=day.json;
        add_header Content-Type application/json;
    }
    location = /api/status_data {
        alias /usr/share/nginx/html/api/status_data_granularity=day.json;
        add_header Content-Type application/json;
    }
    location = /api/chromatography_data {
        alias /usr/share/nginx/html/api/chromatography_data_granularity=day.json;
        add_header Content-Type application/json;
    }
    location = /api/weather_data {
        alias /usr/share/nginx/html/api/weather_data_granularity=day.json;
        add_header Content-Type application/json;
    }
    location = /api/correlation_data {
        alias /usr/share/nginx/html/api/correlation_data_granularity=day&year=2025.json;
        add_header Content-Type application/json;
    }
    location = /api/predictions_data {
        alias /usr/share/nginx/html/api/predictions_data_granularity=day&year=2025&type=oil_temp&points=10.json;
        add_header Content-Type application/json;
    }
    location = /api/anomaly_detection_data {
        alias /usr/share/nginx/html/api/anomaly_detection_data_granularity=day&year=2025.json;
        add_header Content-Type application/json;
    }

    # 可选：阻止访问 .json 文件直接暴露（安全考虑）
    location ~ /\. {
        deny all;
    }
}