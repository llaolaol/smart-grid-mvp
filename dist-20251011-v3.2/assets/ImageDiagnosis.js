import{d as se,r as I,c as H,aJ as _e,b as $,t as n,ah as y,q as o,f as t,H as D,u as B,bs as pe,C as k,D as h,F as Y,B as ee,p as j,e as g,h as te,bi as ae,w as Te,G as ue,aO as le,S as ge,V as ve,a5 as we,aP as fe,bb as he,bd as $e,aa as de,y as me,bt as be,aZ as Se,aA as xe,o as Ie,ba as Me,b4 as Ce}from"./index.js";import{ai as F}from"./index4.js";import{c as oe}from"./index8.js";import"./vnode.js";import"./scroll.js";const Re={class:"image-uploader"},De={class:"card-header"},Fe={class:"upload-area"},Pe={class:"upload-content"},Ae={key:0,class:"file-list"},Ve={class:"file-list-header"},ze={class:"file-items"},Ue={class:"file-preview"},Le=["src","alt","onClick"],Ne={key:1,class:"preview-placeholder"},Oe={class:"file-info"},Ee=["title"],qe={class:"file-size"},Be={key:0,class:"file-error-msg"},je={class:"file-actions"},Je={key:1,class:"upload-summary"},He={class:"summary-item"},Ge={class:"value"},We={class:"summary-item"},Ke={class:"value"},Ze={class:"preview-content"},Qe=["src","alt"],Xe=".jpg,.jpeg,.png,.bmp",Ye=se({__name:"ImageUploader",props:{maxSize:{default:10},maxCount:{default:5}},emits:["files-change","file-remove","files-clear"],setup(T,{expose:s,emit:e}){const a=T,i=e,u=I(),m=I([]),_=I([]),d=I(!1),b=I(""),S=I(""),C=["image/jpeg","image/png","image/bmp"],A=H(()=>_.value.reduce((p,v)=>p+(v.size||0),0)),V=p=>{if(p===0)return"0 B";const v=1024,c=["B","KB","MB","GB"],r=Math.floor(Math.log(p)/Math.log(v));return parseFloat((p/Math.pow(v,r)).toFixed(2))+" "+c[r]},J=p=>{if(!C.includes(p.type))return F.error("只支持 JPEG、PNG、BMP 格式的图片"),!1;const v=a.maxSize*1024*1024;return p.size>v?(F.error(`文件大小不能超过 ${a.maxSize}MB`),!1):!0},q=(p,v)=>{_.value=v,p.status==="ready"&&p.raw&&(p.url=URL.createObjectURL(p.raw));const c=v.filter(r=>r.raw&&r.status!=="fail").map(r=>r.raw);i("files-change",c)},Z=(p,v)=>{p.url&&p.url.startsWith("blob:")&&URL.revokeObjectURL(p.url),_.value=v;const c=v.filter(r=>r.raw&&r.status!=="fail").map(r=>r.raw);i("files-change",c)},Q=()=>{F.warning(`最多只能上传 ${a.maxCount} 个文件`)},W=p=>{const v=_.value[p];v.url&&v.url.startsWith("blob:")&&URL.revokeObjectURL(v.url),_.value.splice(p,1),m.value.splice(p,1);const c=_.value.filter(r=>r.raw&&r.status!=="fail").map(r=>r.raw);i("files-change",c),i("file-remove",p)},O=async()=>{try{await oe.confirm("确认要清空所有已上传的文件吗？","确认清空",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),_.value.forEach(p=>{p.url&&p.url.startsWith("blob:")&&URL.revokeObjectURL(p.url)}),_.value=[],m.value=[],u.value?.clearFiles(),i("files-change",[]),i("files-clear"),F.success("已清空所有文件")}catch{}},w=p=>{p.url&&(b.value=p.url,S.value=p.name,d.value=!0)},E=()=>{d.value=!1,b.value="",S.value=""};return _e(()=>{_.value.forEach(p=>{p.url&&p.url.startsWith("blob:")&&URL.revokeObjectURL(p.url)})}),s({clearFiles:O,getFiles:()=>_.value.filter(p=>p.raw).map(p=>p.raw)}),(p,v)=>{const c=y("el-button"),r=y("el-icon"),z=y("el-upload"),U=y("el-card"),f=y("el-dialog");return g(),$("div",Re,[n(U,{class:"upload-card",shadow:"hover"},{header:o(()=>[t("div",De,[v[2]||(v[2]=t("span",null,"图像上传",-1)),_.value.length>0?(g(),j(c,{key:0,type:"text",onClick:O,class:"clear-btn"},{default:o(()=>[...v[1]||(v[1]=[k(" 清空所有 ",-1)])]),_:1})):D("",!0)])]),default:o(()=>[t("div",Fe,[n(z,{ref_key:"uploadRef",ref:u,class:"upload-dragger","file-list":m.value,"auto-upload":!1,multiple:!0,limit:5,accept:Xe,"before-upload":J,"on-change":q,"on-remove":Z,"on-exceed":Q,drag:""},{default:o(()=>[t("div",Pe,[n(r,{class:"upload-icon"},{default:o(()=>[n(B(pe))]),_:1}),v[3]||(v[3]=t("div",{class:"upload-text"},[t("p",{class:"primary-text"},"将图片拖到此处，或点击选择文件"),t("p",{class:"secondary-text"},[k(" 支持 JPEG、PNG、BMP 格式"),t("br"),k(" 单文件 ≤ 10MB，最多 5 张图片 ")])],-1))])]),_:1},8,["file-list"])]),_.value.length>0?(g(),$("div",Ae,[t("div",Ve,[t("span",null,"已上传文件 ("+h(_.value.length)+"/5)",1)]),t("div",ze,[(g(!0),$(Y,null,ee(_.value,(l,x)=>(g(),$("div",{key:l.uid,class:te(["file-item",{"file-error":l.status==="fail"}])},[t("div",Ue,[l.url?(g(),$("img",{key:0,src:l.url,alt:l.name,class:"preview-image",onClick:M=>w(l)},null,8,Le)):(g(),$("div",Ne,[n(r,null,{default:o(()=>[...v[4]||(v[4]=[t("picture",null,null,-1)])]),_:1})]))]),t("div",Oe,[t("div",{class:"file-name",title:l.name},h(l.name),9,Ee),t("div",qe,h(V(l.size||0)),1),l.status==="fail"?(g(),$("div",Be," 上传失败 ")):D("",!0)]),t("div",je,[n(c,{type:"text",size:"small",onClick:M=>w(l),disabled:!l.url},{default:o(()=>[...v[5]||(v[5]=[k(" 预览 ",-1)])]),_:1},8,["onClick","disabled"]),n(c,{type:"text",size:"small",onClick:M=>W(x),class:"remove-btn"},{default:o(()=>[...v[6]||(v[6]=[k(" 删除 ",-1)])]),_:1},8,["onClick"])])],2))),128))])])):D("",!0),_.value.length>0?(g(),$("div",Je,[t("div",He,[v[7]||(v[7]=t("span",{class:"label"},"总大小:",-1)),t("span",Ge,h(V(A.value)),1)]),t("div",We,[v[8]||(v[8]=t("span",{class:"label"},"文件数量:",-1)),t("span",Ke,h(_.value.length)+"/5",1)])])):D("",!0)]),_:1}),n(f,{modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=l=>d.value=l),title:"图片预览",width:"80%","before-close":E},{footer:o(()=>[n(c,{onClick:E},{default:o(()=>[...v[9]||(v[9]=[k("关闭",-1)])]),_:1})]),default:o(()=>[t("div",Ze,[b.value?(g(),$("img",{key:0,src:b.value,alt:S.value,class:"preview-full-image"},null,8,Qe)):D("",!0)])]),_:1},8,["modelValue"])])}}}),et=ae(Ye,[["__scopeId","data-v-61895a9c"]]),tt={class:"task-manager"},st={class:"card-header"},at={class:"header-actions"},nt={key:0,class:"current-task"},lt={class:"task-header"},ot={class:"task-title"},it={class:"task-name"},rt={class:"task-time"},ct={class:"progress-section"},ut={key:0,class:"current-step"},dt={key:0,class:"error-info"},mt={class:"error-actions"},_t={key:1,class:"completion-info"},pt={class:"completion-details"},gt={key:0},vt={key:1,class:"no-task"},ft={class:"no-task-content"},ht={class:"task-list"},yt={class:"divider-text"},kt={class:"task-items"},Tt=["onClick"],wt={class:"task-item-header"},$t={class:"task-item-info"},bt={class:"task-item-name"},St={class:"task-item-actions"},xt={class:"task-item-details"},It={class:"task-item-time"},Mt={key:0,class:"task-item-progress"},Ct={key:2,class:"task-stats"},Rt={class:"stats-grid"},Dt={class:"stat-item"},Ft={class:"stat-value"},Pt={class:"stat-item"},At={class:"stat-value"},Vt={class:"stat-item"},zt={class:"stat-value"},Ut={class:"stat-item"},Lt={class:"stat-value"},Nt=se({__name:"TaskManager",props:{tasks:{},currentTaskId:{}},emits:["task-select","task-retry","task-remove","tasks-clear-completed"],setup(T,{emit:s}){const e=T,a=s,i=I(!1),u=I(!1),m=H(()=>e.currentTaskId?e.tasks.find(c=>c.task_id===e.currentTaskId):e.tasks.find(c=>["pending","uploading","processing"].includes(c.status))),_=H(()=>e.tasks.filter(c=>["pending","uploading","processing"].includes(c.status))),d=H(()=>e.tasks.filter(c=>c.status==="completed")),b=H(()=>e.tasks.filter(c=>c.status==="failed"));Te(()=>e.tasks.length,(c,r)=>{c>r&&(i.value=!0)});const S=c=>`${c.params.equipment_info.device_id} - ${c.params.image_type} 诊断`,C=c=>({pending:"等待中",uploading:"上传中",processing:"处理中",completed:"已完成",failed:"失败"})[c]||c,A=c=>({pending:"info",uploading:"warning",processing:"primary",completed:"success",failed:"danger"})[c]||"info",V=c=>{if(c==="completed")return"success";if(c==="failed")return"exception"},J=c=>({pending:de,uploading:$e,processing:he,completed:fe,failed:we})[c]||de,q=c=>({pending:"icon-pending",uploading:"icon-uploading",processing:"icon-processing",completed:"icon-completed",failed:"icon-failed"})[c]||"",Z=c=>{const r=new Date,z=new Date(c),U=r.getTime()-z.getTime(),f=Math.floor(U/(1e3*60));if(f<1)return"刚刚";if(f<60)return`${f}分钟前`;const l=Math.floor(f/60);return l<24?`${l}小时前`:`${Math.floor(l/24)}天前`},Q=c=>new Date(c).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=c=>{if(!c.started_at||!c.completed_at)return"未知";const r=new Date(c.started_at).getTime(),z=new Date(c.completed_at).getTime(),U=Math.floor((z-r)/1e3);if(U<60)return`${U}秒`;const f=Math.floor(U/60),l=U%60;return`${f}分${l}秒`},O=()=>{i.value=!i.value},w=c=>{a("task-select",c)},E=async c=>{try{u.value=!0,a("task-retry",c),F.success("任务已重新开始")}catch{F.error("重试失败")}finally{u.value=!1}},p=async c=>{try{await oe.confirm("确认要移除这个任务吗？","确认移除",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),a("task-remove",c),F.success("任务已移除")}catch{}},v=async()=>{try{await oe.confirm(`确认要清理 ${d.value.length} 个已完成的任务吗？`,"确认清理",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}),a("tasks-clear-completed"),F.success("已清理完成的任务")}catch{}};return(c,r)=>{const z=y("el-button"),U=y("el-badge"),f=y("el-icon"),l=y("el-tag"),x=y("el-progress"),M=y("el-alert"),L=y("el-divider"),R=y("el-collapse-transition"),N=y("el-card");return g(),$("div",tt,[n(N,{class:"task-card",shadow:"hover"},{header:o(()=>[t("div",st,[r[3]||(r[3]=t("span",null,"任务状态",-1)),t("div",at,[_.value.length>0?(g(),j(U,{key:0,value:_.value.length,type:"primary"},{default:o(()=>[n(z,{type:"text",size:"small",onClick:O},{default:o(()=>[k(h(i.value?"收起":"展开"),1)]),_:1})]),_:1},8,["value"])):D("",!0),d.value.length>0?(g(),j(z,{key:1,type:"text",size:"small",onClick:v,class:"clear-btn"},{default:o(()=>[...r[2]||(r[2]=[k(" 清理已完成 ",-1)])]),_:1})):D("",!0)])])]),default:o(()=>[m.value?(g(),$("div",nt,[t("div",lt,[t("div",ot,[n(f,{class:te(["task-icon",q(m.value.status)])},{default:o(()=>[(g(),j(ue(J(m.value.status))))]),_:1},8,["class"]),t("span",it,h(S(m.value)),1),n(l,{type:A(m.value.status),size:"small",class:"status-tag"},{default:o(()=>[k(h(C(m.value.status)),1)]),_:1},8,["type"])]),t("div",rt,h(Z(m.value.created_at)),1)]),t("div",ct,[n(x,{percentage:m.value.progress,status:V(m.value.status),"show-text":!0,"stroke-width":8,class:"task-progress"},null,8,["percentage","status"]),m.value.current_step?(g(),$("div",ut," 当前步骤: "+h(m.value.current_step),1)):D("",!0)]),m.value.status==="failed"&&m.value.error_message?(g(),$("div",dt,[n(M,{title:m.value.error_message,type:"error",closable:!1,"show-icon":""},{default:o(()=>[t("div",mt,[n(z,{type:"primary",size:"small",onClick:r[0]||(r[0]=P=>E(m.value.task_id)),loading:u.value},{default:o(()=>[...r[4]||(r[4]=[k(" 重试 ",-1)])]),_:1},8,["loading"]),n(z,{type:"text",size:"small",onClick:r[1]||(r[1]=P=>p(m.value.task_id))},{default:o(()=>[...r[5]||(r[5]=[k(" 移除 ",-1)])]),_:1})])]),_:1},8,["title"])])):D("",!0),m.value.status==="completed"?(g(),$("div",_t,[n(M,{title:"诊断完成",type:"success",closable:!1,"show-icon":""},{default:o(()=>[t("div",pt,[t("p",null,"处理耗时: "+h(W(m.value)),1),m.value.result?(g(),$("p",gt," 发现问题: "+h(m.value.result.image_analysis.discharge_type),1)):D("",!0)])]),_:1})])):D("",!0)])):(g(),$("div",vt,[t("div",ft,[n(f,{class:"no-task-icon"},{default:o(()=>[n(B(le))]),_:1}),r[6]||(r[6]=t("p",{class:"no-task-text"},"暂无进行中的任务",-1)),r[7]||(r[7]=t("p",{class:"no-task-hint"},"上传图像并开始诊断",-1))])])),n(R,null,{default:o(()=>[ge(t("div",ht,[n(L,{"content-position":"left"},{default:o(()=>[t("span",yt,"任务历史 ("+h(T.tasks.length)+")",1)]),_:1}),t("div",kt,[(g(!0),$(Y,null,ee(T.tasks.slice().reverse(),P=>(g(),$("div",{key:P.task_id,class:te(["task-item",{"task-active":P.task_id===m.value?.task_id}]),onClick:G=>w(P.task_id)},[t("div",wt,[t("div",$t,[n(f,{class:te(["task-item-icon",q(P.status)])},{default:o(()=>[(g(),j(ue(J(P.status))))]),_:2},1032,["class"]),t("span",bt,h(S(P)),1),n(l,{type:A(P.status),size:"small"},{default:o(()=>[k(h(C(P.status)),1)]),_:2},1032,["type"])]),t("div",St,[P.status==="failed"?(g(),j(z,{key:0,type:"text",size:"small",onClick:me(G=>E(P.task_id),["stop"]),loading:u.value},{default:o(()=>[...r[8]||(r[8]=[k(" 重试 ",-1)])]),_:1},8,["onClick","loading"])):D("",!0),n(z,{type:"text",size:"small",onClick:me(G=>p(P.task_id),["stop"]),class:"remove-btn"},{default:o(()=>[...r[9]||(r[9]=[k(" 移除 ",-1)])]),_:1},8,["onClick"])])]),t("div",xt,[t("div",It,h(Q(P.created_at)),1),P.status==="processing"||P.status==="uploading"?(g(),$("div",Mt,[n(x,{percentage:P.progress,"show-text":!1,"stroke-width":4,status:V(P.status)},null,8,["percentage","status"])])):D("",!0)])],10,Tt))),128))])],512),[[ve,i.value&&T.tasks.length>0]])]),_:1}),T.tasks.length>0?(g(),$("div",Ct,[t("div",Rt,[t("div",Dt,[r[10]||(r[10]=t("span",{class:"stat-label"},"总任务",-1)),t("span",Ft,h(T.tasks.length),1)]),t("div",Pt,[r[11]||(r[11]=t("span",{class:"stat-label"},"进行中",-1)),t("span",At,h(_.value.length),1)]),t("div",Vt,[r[12]||(r[12]=t("span",{class:"stat-label"},"已完成",-1)),t("span",zt,h(d.value.length),1)]),t("div",Ut,[r[13]||(r[13]=t("span",{class:"stat-label"},"失败",-1)),t("span",Lt,h(b.value.length),1)])])])):D("",!0)]),_:1})])}}}),Ot=ae(Nt,[["__scopeId","data-v-6cee6fb6"]]),Et={class:"result-display"},qt={class:"card-header"},Bt={class:"header-actions"},jt={class:"summary-section"},Jt={class:"summary-item"},Ht={class:"summary-value"},Gt={class:"summary-location"},Wt={class:"summary-item"},Kt={class:"summary-value"},Zt={class:"summary-location"},Qt={key:0,class:"insights-section"},Xt={class:"section-title"},Yt={class:"insights-list"},es={class:"insight-text"},ts={key:1,class:"recommendations-section"},ss={class:"section-title"},as={class:"recommendations-list"},ns={class:"recommendation-number"},ls={class:"recommendation-content"},os={key:2,class:"detailed-analysis-section"},is={class:"section-title"},rs={class:"analysis-actions"},cs={class:"analysis-content"},us=["innerHTML"],ds={class:"analysis-content"},ms=["innerHTML"],_s={class:"analysis-content"},ps={class:"full-analysis-container"},gs=["innerHTML"],vs={class:"technical-section"},fs={class:"section-title"},hs={class:"processing-steps"},ys={class:"no-result-content"},ks={class:"preview-content"},Ts=["src","alt"],ws=se({__name:"ResultDisplay",props:{result:{}},emits:["export-result"],setup(T,{emit:s}){const e=T,a=s,i=I(!1),u=I(!1),m=I(!1),_=I(""),d=I(""),b=I(!1),S=I(!1),C=I(["features","judgment"]),A=O=>new Date(O).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),V=()=>{i.value=!i.value},J=async()=>{if(e.result)try{u.value=!0,a("export-result",e.result),F.success("报告导出成功")}catch{F.error("导出失败")}finally{u.value=!1}},q=()=>{m.value=!1,_.value="",d.value=""},Z=()=>{b.value=!b.value,b.value?C.value=["features","judgment","full"]:C.value=["features","judgment"]},Q=async()=>{if(e.result?.detailed_analysis?.full_content){S.value=!0;try{await navigator.clipboard.writeText(e.result.detailed_analysis.full_content),F.success("分析内容已复制到剪贴板")}catch(O){console.error("复制失败:",O),F.error("复制失败，请手动选择复制")}finally{S.value=!1}}},W=O=>O?O.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/### (.+)/g,'<h6 class="analysis-subtitle">$1</h6>').replace(/^\s*[-*]\s+(.+)$/gm,"<li>$1</li>").replace(/\n/g,"<br>").replace(/(<li>.*<\/li>)/g,'<ul class="analysis-list">$1</ul>').replace(/<\/ul><br><ul class="analysis-list">/g,""):"";return(O,w)=>{const E=y("el-button"),p=y("el-col"),v=y("el-row"),c=y("el-icon"),r=y("el-collapse-item"),z=y("el-collapse"),U=y("el-descriptions-item"),f=y("el-tag"),l=y("el-descriptions"),x=y("el-collapse-transition"),M=y("el-card"),L=y("el-dialog");return g(),$("div",Et,[T.result?(g(),j(M,{key:0,class:"result-card",shadow:"hover"},{header:o(()=>[t("div",qt,[w[3]||(w[3]=t("span",null,"诊断结果",-1)),t("div",Bt,[n(E,{type:"text",size:"small",onClick:V},{default:o(()=>[k(h(i.value?"简要视图":"详细视图"),1)]),_:1}),n(E,{type:"primary",size:"small",onClick:J,loading:u.value},{default:o(()=>[...w[2]||(w[2]=[k(" 导出报告 ",-1)])]),_:1},8,["loading"])])])]),default:o(()=>[t("div",jt,[n(v,{gutter:20},{default:o(()=>[n(p,{span:12},{default:o(()=>[t("div",Jt,[w[4]||(w[4]=t("div",{class:"summary-label"},"设备信息",-1)),t("div",Ht,h(T.result.equipment_info.device_id)+" - "+h(T.result.equipment_info.device_type),1),t("div",Gt,h(T.result.equipment_info.location),1)])]),_:1}),n(p,{span:12},{default:o(()=>[t("div",Wt,[w[5]||(w[5]=t("div",{class:"summary-label"},"诊断时间",-1)),t("div",Kt,h(A(T.result.diagnosis_time)),1),t("div",Zt,"耗时: "+h(T.result.processing_duration)+"秒",1)])]),_:1})]),_:1})]),T.result.ai_insights&&T.result.ai_insights.length>0?(g(),$("div",Qt,[t("h4",Xt,[n(c,null,{default:o(()=>[n(B(be))]),_:1}),w[6]||(w[6]=k(" AI 洞察 ",-1))]),t("div",Yt,[(g(!0),$(Y,null,ee(T.result.ai_insights,(R,N)=>(g(),$("div",{key:N,class:"insight-item"},[n(c,{class:"insight-icon"},{default:o(()=>[n(B(xe))]),_:1}),t("span",es,h(R),1)]))),128))])])):D("",!0),T.result.recommended_actions&&T.result.recommended_actions.length>0?(g(),$("div",ts,[t("h4",ss,[n(c,null,{default:o(()=>[n(B(Se))]),_:1}),w[7]||(w[7]=k(" 推荐措施 ",-1))]),t("div",as,[(g(!0),$(Y,null,ee(T.result.recommended_actions,(R,N)=>(g(),$("div",{key:N,class:"recommendation-item"},[t("div",ns,h(N+1),1),t("div",ls,h(R),1)]))),128))])])):D("",!0),T.result.detailed_analysis&&T.result.detailed_analysis.full_content?(g(),$("div",os,[t("h4",is,[n(c,null,{default:o(()=>[n(B(le))]),_:1}),w[8]||(w[8]=k(" 详细分析报告 ",-1)),t("div",rs,[n(E,{type:"text",size:"small",onClick:Z},{default:o(()=>[k(h(b.value?"收起":"展开全部"),1)]),_:1}),n(E,{type:"text",size:"small",onClick:Q,loading:S.value},{default:o(()=>[k(h(S.value?"复制中...":"复制内容"),1)]),_:1},8,["loading"])])]),n(z,{modelValue:C.value,"onUpdate:modelValue":w[0]||(w[0]=R=>C.value=R),class:"analysis-collapse"},{default:o(()=>[T.result.detailed_analysis.structured_content.featureAnalysis?(g(),j(r,{key:0,name:"features",title:"特征分析"},{default:o(()=>[t("div",cs,[t("div",{class:"analysis-text",innerHTML:W(T.result.detailed_analysis.structured_content.featureAnalysis)},null,8,us)])]),_:1})):D("",!0),T.result.detailed_analysis.structured_content.comprehensiveJudgment?(g(),j(r,{key:1,name:"judgment",title:"综合判断"},{default:o(()=>[t("div",ds,[t("div",{class:"analysis-text",innerHTML:W(T.result.detailed_analysis.structured_content.comprehensiveJudgment)},null,8,ms)])]),_:1})):D("",!0),n(r,{name:"full",title:"完整分析报告"},{default:o(()=>[t("div",_s,[t("div",ps,[t("div",{class:"analysis-text full-content",innerHTML:W(T.result.detailed_analysis.full_content)},null,8,gs)])])]),_:1})]),_:1},8,["modelValue"])])):D("",!0),n(x,null,{default:o(()=>[ge(t("div",vs,[t("h4",fs,[n(c,null,{default:o(()=>[n(B(he))]),_:1}),w[9]||(w[9]=k(" 技术细节 ",-1))]),n(l,{column:1,border:""},{default:o(()=>[n(U,{label:"算法版本"},{default:o(()=>[k(h(T.result.technical_details?.algorithm_version),1)]),_:1}),n(U,{label:"模型置信度"},{default:o(()=>[k(h((T.result.technical_details?.model_confidence||0).toFixed(2))+"% ",1)]),_:1}),n(U,{label:"处理步骤"},{default:o(()=>[t("div",hs,[(g(!0),$(Y,null,ee(T.result.technical_details?.processing_steps,(R,N)=>(g(),j(f,{key:N,size:"small",class:"step-tag"},{default:o(()=>[k(h(N+1)+". "+h(R),1)]),_:2},1024))),128))])]),_:1})]),_:1})],512),[[ve,i.value&&T.result.technical_details]])]),_:1})]),_:1})):(g(),j(M,{key:1,class:"no-result-card",shadow:"hover"},{default:o(()=>[t("div",ys,[n(c,{class:"no-result-icon"},{default:o(()=>[n(B(le))]),_:1}),w[10]||(w[10]=t("p",{class:"no-result-text"},"暂无诊断结果",-1)),w[11]||(w[11]=t("p",{class:"no-result-hint"},"完成图像诊断后结果将在此处显示",-1))])]),_:1})),n(L,{modelValue:m.value,"onUpdate:modelValue":w[1]||(w[1]=R=>m.value=R),title:d.value,width:"90%","before-close":q},{footer:o(()=>[n(E,{onClick:q},{default:o(()=>[...w[12]||(w[12]=[k("关闭",-1)])]),_:1})]),default:o(()=>[t("div",ks,[_.value?(g(),$("img",{key:0,src:_.value,alt:d.value,class:"preview-full-image"},null,8,Ts)):D("",!0)])]),_:1},8,["modelValue","title"])])}}}),$s=ae(ws,[["__scopeId","data-v-79d8135b"]]),ne="https://n8n.bd.kxsz.net:9443/webhook/upload-image";class X{static async submitDiagnosisTask(s){return this.submitToN8N(s)}static async getTaskStatus(s){const e=await fetch(`${ne}/status/${s}`);if(!e.ok)throw new Error(`获取任务状态失败: ${e.statusText}`);return e.json()}static async cancelTask(s){const e=await fetch(`${ne}/cancel/${s}`,{method:"POST"});if(!e.ok)throw new Error(`取消任务失败: ${e.statusText}`)}static async mockSubmitDiagnosisTask(s){await new Promise(u=>setTimeout(u,500));const e=this.generateTaskId(),a=new Date().toISOString(),i={task_id:e,status:"pending",created_at:a,updated_at:a,params:s,progress:0,retry_count:0};return this.saveTaskToStorage(i),this.simulateTaskProcessing(e),i}static async mockGetTaskStatus(s){await new Promise(a=>setTimeout(a,200));const e=this.getTaskFromStorage(s);if(!e)throw new Error(`任务 ${s} 不存在`);return e}static async mockCancelTask(s){await new Promise(a=>setTimeout(a,300));const e=this.getTaskFromStorage(s);e&&["pending","uploading","processing"].includes(e.status)&&(e.status="failed",e.error_message="任务已被用户取消",e.updated_at=new Date().toISOString(),this.saveTaskToStorage(e))}static async simulateTaskProcessing(s){const e=a=>{const i=this.getTaskFromStorage(s);i&&(Object.assign(i,a,{updated_at:new Date().toISOString()}),this.saveTaskToStorage(i))};try{e({status:"uploading",progress:10,current_step:"上传图像文件..."}),await this.sleep(1e3),e({progress:30}),await this.sleep(1e3),e({progress:50}),await this.sleep(500),e({status:"processing",progress:60,current_step:"图像预处理...",started_at:new Date().toISOString()}),await this.sleep(1e3),e({progress:70,current_step:"特征提取与分析..."}),await this.sleep(1500),e({progress:85,current_step:"AI模型推理..."}),await this.sleep(1e3),e({progress:95,current_step:"生成诊断报告..."}),await this.sleep(800);const a=this.generateMockResult(s);e({status:"completed",progress:100,current_step:"诊断完成",completed_at:new Date().toISOString(),result:a})}catch{Math.random()<.05&&e({status:"failed",error_message:"图像处理服务暂时不可用，请稍后重试",current_step:"处理失败"})}}static generateMockResult(s){const e=this.getTaskFromStorage(s);if(!e)throw new Error("任务不存在");const a=["局部放电","悬浮放电","尖端放电","沿面放电","绝缘老化","无明显异常"],i=["A相绕组","B相绕组","C相绕组","绕组接头","套管区域","铁芯接地","油箱内部","未明确定位"],u=a[Math.floor(Math.random()*a.length)],m=u==="无明显异常",_=m?1:Math.floor(Math.random()*4)+2,d=.6+Math.random()*.35,b=m?Math.random()*.3:.4+Math.random()*.6,S=this.generateInsights(u,_),C=this.generateRecommendations(u,_),A=this.generateProcessedImages(e.params.image_files);return{task_id:s,equipment_info:e.params.equipment_info,image_analysis:{discharge_type:u,severity_level:_,confidence_score:d,fault_location:i[Math.floor(Math.random()*i.length)],fault_probability:b},ai_insights:S,recommended_actions:C,processed_images:A,diagnosis_time:new Date().toISOString(),processing_duration:8+Math.floor(Math.random()*7),technical_details:{algorithm_version:"v2.1.3",model_confidence:d,processing_steps:["图像质量检测","特征点提取","模式识别","故障分类","置信度计算"]}}}static generateInsights(s,e){const a=[`检测到${s}模式，建议进一步监测`,`当前严重程度为 ${e}/5，需要关注设备运行状态`];return e>=4?(a.push("高严重程度故障，建议立即安排检修"),a.push("建议停机检查，避免故障扩大")):e>=3?a.push("中等严重程度，建议加强监测频率"):a.push("轻微异常，可继续运行但需密切监测"),s!=="无明显异常"&&a.push("建议结合油气分析数据进行综合判断"),a}static generateRecommendations(s,e){const a=[];return s==="无明显异常"?(a.push("继续正常运行，保持定期监测"),a.push("建议3个月后复检"),a):(a.push("立即通知运维人员，记录发现时间"),e>=4?(a.push("立即安排停电检修，避免事故扩大"),a.push("联系专业检修团队进行详细检查"),a.push("准备备用设备，确保供电连续性")):e>=3?(a.push("制定检修计划，尽快安排停电检查"),a.push("加强日常巡检，每日记录设备状态"),a.push("进行油气分析，获取更多诊断信息")):(a.push("增加监测频率，每周进行一次检查"),a.push("观察故障发展趋势，记录变化情况")),s.includes("绕组")&&a.push("重点检查绕组绝缘状况和接头连接"),s.includes("放电")&&a.push("使用超声波检测定位放电源"),a)}static generateProcessedImages(s){return s.map((e,a)=>{const i=`img_${Date.now()}_${a}`,u=URL.createObjectURL(e),m=u,_=[],d=Math.floor(Math.random()*3)+1;for(let b=0;b<d;b++)_.push({annotation_id:`ann_${i}_${b}`,type:"bbox",coordinates:[Math.random()*100,Math.random()*100,20+Math.random()*30,20+Math.random()*30],label:["放电点","异常区域","疑似故障"][Math.floor(Math.random()*3)],confidence:.7+Math.random()*.3,description:"检测到的异常区域"});return{image_id:i,original_name:e.name,original_url:u,processed_url:m,annotations:_,file_size:e.size,dimensions:{width:1024+Math.floor(Math.random()*1024),height:768+Math.floor(Math.random()*768)}}})}static async submitToN8N(s){const e=this.generateTaskId(),a=new Date().toISOString();try{const i={task_id:e,status:"uploading",created_at:a,updated_at:a,started_at:a,params:s,progress:20,current_step:"上传图像到n8n服务器...",retry_count:0};this.saveTaskToStorage(i);const u=[];for(let d=0;d<s.image_files.length;d++){const b=s.image_files[d],S=new FormData;S.append("file",b),S.append("device_id",s.equipment_info.device_id),S.append("device_type",s.equipment_info.device_type),S.append("location",s.equipment_info.location),S.append("image_type",s.image_type),S.append("sensitivity",s.sensitivity),S.append("file_index",d.toString());const C=20+d/s.image_files.length*60;this.updateTaskProgress(e,C,`正在处理第${d+1}/${s.image_files.length}个图像...`);const A=await fetch(ne,{method:"POST",body:S});if(!A.ok)throw new Error(`图像诊断请求失败: ${A.status} ${A.statusText}`);let V;const J=A.headers.get("content-type");if(J&&J.includes("application/json"))V=await A.json();else{const q=await A.text();try{V=JSON.parse(q)}catch{V={message:q,file_name:b.name}}}u.push(V)}this.updateTaskProgress(e,90,"生成诊断报告...");const m=this.convertN8nResultToSystemFormat(e,u,i),_={...i,status:"completed",progress:100,current_step:"诊断完成",completed_at:new Date().toISOString(),updated_at:new Date().toISOString(),result:m};return this.saveTaskToStorage(_),_}catch(i){console.error("N8N图像诊断请求失败:",i);const u={task_id:e,status:"failed",created_at:a,updated_at:new Date().toISOString(),started_at:a,params:s,progress:0,current_step:"诊断失败",error_message:i instanceof Error?i.message:"未知错误",retry_count:0};throw this.saveTaskToStorage(u),new Error(`图像诊断失败: ${i instanceof Error?i.message:"未知错误"}`)}}static updateTaskProgress(s,e,a){const i=this.getTaskFromStorage(s);i&&(i.progress=e,i.current_step=a,i.updated_at=new Date().toISOString(),this.saveTaskToStorage(i))}static updateTaskStatus(s,e,a,i){const u=this.getTaskFromStorage(s);u&&(u.status=e,u.progress=a,u.current_step=i,u.updated_at=new Date().toISOString(),this.saveTaskToStorage(u))}static convertN8nResultToSystemFormat(s,e,a){const i=e[0]||{},u=i.content||"",m=i.annotations||[],_=this.extractAnalysisInfo(u),d=_.dischargeType||"图像分析完成",b=_.confidence||.85,S=this.calculateSeverityFromAnalysis(u),C=this.generateInsightsFromAnalysisContent(u),A=this.generateRecommendationsFromAnalysisContent(u),V=this.generateProcessedImagesFromN8nResult(a.params.image_files,e);return{task_id:s,equipment_info:a.params.equipment_info,image_analysis:{discharge_type:d,severity_level:S,confidence_score:b,fault_location:_.faultLocation||"需要进一步分析确定",fault_probability:_.faultProbability||b},ai_insights:C,recommended_actions:A,processed_images:V,diagnosis_time:new Date().toISOString(),processing_duration:Math.floor((new Date().getTime()-new Date(a.created_at).getTime())/1e3),technical_details:{algorithm_version:"n8n-v2.0",model_confidence:b,processing_steps:["图像上传完成","AI图像分析处理","特征提取与分类","综合判断完成"]},detailed_analysis:{full_content:u,structured_content:this.parseAnalysisContent(u),annotations:m}}}static extractAnalysisInfo(s){const e={dischargeType:"",confidence:.85,faultLocation:"",faultProbability:.85},a=s.match(/判断该局部放电类型为：\*\*(.+?)\*\*/);return a&&(e.dischargeType=a[1]),s.includes("明显的对称性")&&s.includes("集中分布较密集")&&(e.confidence=.9,e.faultProbability=.88),s.includes("正半周")&&s.includes("负半周")&&(e.faultLocation="正负半周对称分布区域"),e}static parseAnalysisContent(s){const e={featureAnalysis:"",dischargeCharacteristics:"",comprehensiveJudgment:""},a=s.match(/### 特征分析：([\s\S]*?)### 综合判断：/);a&&(e.featureAnalysis=a[1].trim());const i=s.match(/### 综合判断：([\s\S]*?)因此，判断该局部放电类型为：/);return i&&(e.comprehensiveJudgment=i[1].trim()),e}static calculateSeverityFromAnalysis(s){return s.includes("绝缘内部放电")?4:s.includes("对称性")&&s.includes("集中分布较密集")?3:s.includes("无明显异常")?1:3}static generateInsightsFromAnalysisContent(s){const e=[];return s.includes("绝缘内部放电")&&e.push("AI检测到绝缘内部放电特征，需要重点关注设备绝缘状况"),s.includes("对称性")&&e.push("放电数据显示明显的对称性分布，符合典型放电模式"),s.includes("正半周")&&s.includes("负半周")&&e.push("放电在正负半周期中均匀分布，表明故障具有周期性特征"),s.includes("集中分布较密集")&&e.push("放电数据集中分布，表明故障位置相对固定"),e.push("建议结合其他检测手段进行综合判断"),e.push("定期监测放电趋势变化情况"),e}static generateRecommendationsFromAnalysisContent(s){const e=[];return s.includes("绝缘内部放电")&&(e.push("立即安排绝缘系统专项检查"),e.push("测量绝缘电阻和介质损耗因数"),e.push("检查绝缘材料老化情况")),s.includes("对称性")&&s.includes("集中分布")&&(e.push("定位具体故障点，制定针对性维修方案"),e.push("加强该区域的监测频率")),e.push("建立设备档案，跟踪放电发展趋势"),e.push("制定应急预案，防止故障扩大"),e.push("定期进行局部放电检测"),e}static calculateSeverityFromResult(s){return s.severity_level?s.severity_level:s.confidence&&s.confidence>.8?4:s.confidence&&s.confidence>.6?3:2}static generateInsightsFromN8nResult(s){const e=[];if(s.length>0){const a=s[0];a.message&&e.push(`n8n分析结果: ${a.message}`),a.diagnosis&&e.push(`诊断结论: ${a.diagnosis}`),a.confidence&&e.push(`分析置信度: ${(a.confidence*100).toFixed(1)}%`),e.push("建议结合其他检测手段进行综合判断")}else e.push("图像已成功上传并处理"),e.push("请查看具体分析结果");return e}static generateRecommendationsFromN8nResult(s){const e=[];if(s.length>0){const a=s[0];a.recommendation&&e.push(a.recommendation),a.next_steps&&e.push(a.next_steps)}return e.push("记录分析结果并存档"),e.push("定期进行图像诊断监测"),e.push("如有异常请联系专业技术人员"),e}static generateProcessedImagesFromN8nResult(s,e){return s.map((a,i)=>{const u=`img_${Date.now()}_${i}`,m=URL.createObjectURL(a),_=e[i]||e[0]||{},d=[];return _.annotations&&_.annotations.forEach((b,S)=>{d.push({annotation_id:`ann_${u}_${S}`,type:b.type||"bbox",coordinates:b.coordinates||[],label:b.label||"检测区域",confidence:b.confidence||.8,description:b.description||"自动检测标注"})}),{image_id:u,original_name:a.name,original_url:m,processed_url:m,annotations:d,file_size:a.size,dimensions:{width:1024,height:768}}})}static generateTaskId(){return`task_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}static sleep(s){return new Promise(e=>setTimeout(e,s))}static saveTaskToStorage(s){const e=this.getAllTasksFromStorage(),a=e.findIndex(i=>i.task_id===s.task_id);a>=0?e[a]=s:e.push(s),localStorage.setItem("image_diagnosis_tasks",JSON.stringify(e))}static getTaskFromStorage(s){return this.getAllTasksFromStorage().find(a=>a.task_id===s)||null}static getAllTasksFromStorage(){try{const s=localStorage.getItem("image_diagnosis_tasks");return s?JSON.parse(s):[]}catch(s){return console.error("解析任务数据失败:",s),[]}}static clearTasksFromStorage(){localStorage.removeItem("image_diagnosis_tasks")}static getAllTasks(){return this.getAllTasksFromStorage()}static removeTask(s){const a=this.getAllTasksFromStorage().filter(i=>i.task_id!==s);localStorage.setItem("image_diagnosis_tasks",JSON.stringify(a))}static clearCompletedTasks(){const e=this.getAllTasksFromStorage().filter(a=>a.status!=="completed");localStorage.setItem("image_diagnosis_tasks",JSON.stringify(e))}}const bs={class:"image-diagnosis"},Ss={class:"page-header"},xs={class:"header-content"},Is={class:"title-section"},Ms={class:"page-title"},Cs={class:"header-stats"},Rs={class:"stat-item"},Ds={class:"stat-value"},Fs={class:"stat-item"},Ps={class:"stat-value"},As={class:"stat-item"},Vs={class:"stat-value"},zs={class:"main-content"},Us={class:"left-panel"},Ls={class:"card-header"},Ns={class:"control-content"},Os={class:"control-info"},Es={key:0,class:"no-files-hint"},qs={key:1,class:"files-ready"},Bs={class:"right-panel"},js=se({__name:"ImageDiagnosis",setup(T){const s=I(),e=I(),a=I([]),i=I([]),u=I(""),m=I(!1),_=I(null),d=I({device_id:"",device_type:"",location:"",image_type:"PRPD",sensitivity:"medium"}),b={device_id:[{required:!0,message:"请输入设备编号",trigger:"blur"},{min:2,max:50,message:"设备编号长度在 2 到 50 个字符",trigger:"blur"}],device_type:[{required:!0,message:"请选择设备类型",trigger:"change"}],location:[{required:!0,message:"请输入设备位置",trigger:"blur"},{min:2,max:100,message:"设备位置长度在 2 到 100 个字符",trigger:"blur"}],image_type:[{required:!0,message:"请选择图像类型",trigger:"change"}]},S=H(()=>a.value.length>0&&d.value.device_id.trim()!==""&&d.value.device_type!==""&&d.value.location.trim()!==""&&!m.value),C=H(()=>i.value.filter(f=>["pending","uploading","processing"].includes(f.status))),A=H(()=>i.value.filter(f=>f.status==="completed")),V=H(()=>i.value.length),J=H(()=>u.value?i.value.find(f=>f.task_id===u.value):C.value[0]||null),q=H(()=>J.value?.result||null);Ie(()=>{Z(),Q()}),_e(()=>{W()});const Z=()=>{const f=X.getAllTasks(),l=[...i.value];f.forEach(M=>{const L=l.findIndex(R=>R.task_id===M.task_id);if(L>=0){const R=l[L];M.updated_at>R.updated_at&&(l[L]=M)}else l.push(M)}),i.value=l;const x=C.value[0];x&&!u.value&&(u.value=x.task_id)},Q=()=>{_.value=window.setInterval(()=>{Z()},2e3)},W=()=>{_.value&&(clearInterval(_.value),_.value=null)},O=f=>{a.value=f},w=()=>{a.value=[]},E=()=>{d.value={device_id:"",device_type:"",location:"",image_type:"PRPD",sensitivity:"medium"},s.value?.clearValidate()},p=async()=>{try{if(await s.value?.validate(),a.value.length===0){F.warning("请先上传图像文件");return}m.value=!0;const l={equipment_info:{device_id:d.value.device_id,device_type:d.value.device_type,location:d.value.location},image_files:a.value,image_type:d.value.image_type,sensitivity:d.value.sensitivity},x=await X.submitDiagnosisTask(l),M=i.value.findIndex(L=>L.task_id===x.task_id);M>=0?i.value[M]=x:i.value.unshift(x),u.value=x.task_id,x.status==="completed"?F.success("诊断已完成！请查看结果"):x.status==="failed"?F.error(`诊断失败: ${x.error_message||"未知错误"}`):F.success("诊断任务已提交，请等待处理结果")}catch(f){console.error("提交诊断任务失败:",f),F.error("提交失败，请检查网络连接后重试")}finally{m.value=!1}},v=f=>{u.value=f},c=async f=>{try{const l=i.value.find(L=>L.task_id===f);if(!l)return;const x=await X.submitDiagnosisTask(l.params),M=i.value.findIndex(L=>L.task_id===f);M>=0&&(i.value[M]=x,u.value=x.task_id),F.success("任务已重新提交")}catch(l){console.error("重试任务失败:",l),F.error("重试失败，请稍后再试")}},r=f=>{if(X.removeTask(f),i.value=i.value.filter(l=>l.task_id!==f),u.value===f){const l=C.value[0]||i.value[0];u.value=l?.task_id||""}},z=()=>{if(X.clearCompletedTasks(),i.value=i.value.filter(l=>l.status!=="completed"),!i.value.some(l=>l.task_id===u.value)){const l=C.value[0]||i.value[0];u.value=l?.task_id||""}},U=async f=>{try{F.success("报告导出功能待实现"),console.log("导出结果:",f)}catch(l){console.error("导出失败:",l),F.error("导出失败")}};return(f,l)=>{const x=y("el-icon"),M=y("el-button"),L=y("el-input"),R=y("el-form-item"),N=y("el-option"),P=y("el-select"),G=y("el-radio"),ie=y("el-radio-group"),ye=y("el-form"),re=y("el-card"),ce=y("el-col"),ke=y("el-row");return g(),$("div",bs,[t("div",Ss,[t("div",xs,[t("div",Is,[t("h1",Ms,[n(x,{class:"title-icon"},{default:o(()=>[n(B(pe))]),_:1}),l[5]||(l[5]=k(" 图像诊断 ",-1))]),l[6]||(l[6]=t("p",{class:"page-description"}," 上传局部放电图像，通过AI智能分析识别设备故障 ",-1))]),t("div",Cs,[t("div",Rs,[t("span",Ds,h(V.value),1),l[7]||(l[7]=t("span",{class:"stat-label"},"总任务",-1))]),t("div",Fs,[t("span",Ps,h(C.value.length),1),l[8]||(l[8]=t("span",{class:"stat-label"},"进行中",-1))]),t("div",As,[t("span",Vs,h(A.value.length),1),l[9]||(l[9]=t("span",{class:"stat-label"},"已完成",-1))])])])]),t("div",zs,[n(ke,{gutter:24},{default:o(()=>[n(ce,{lg:10,md:12,sm:24},{default:o(()=>[t("div",Us,[n(re,{class:"config-card",shadow:"hover"},{header:o(()=>[t("div",Ls,[l[11]||(l[11]=t("span",null,"设备信息",-1)),n(M,{type:"text",size:"small",onClick:E},{default:o(()=>[...l[10]||(l[10]=[k(" 重置 ",-1)])]),_:1})])]),default:o(()=>[n(ye,{ref_key:"formRef",ref:s,model:d.value,rules:b,"label-width":"100px",class:"diagnosis-form"},{default:o(()=>[n(R,{label:"设备编号",prop:"device_id",required:""},{default:o(()=>[n(L,{modelValue:d.value.device_id,"onUpdate:modelValue":l[0]||(l[0]=K=>d.value.device_id=K),placeholder:"请输入设备编号",clearable:""},null,8,["modelValue"])]),_:1}),n(R,{label:"设备类型",prop:"device_type",required:""},{default:o(()=>[n(P,{modelValue:d.value.device_type,"onUpdate:modelValue":l[1]||(l[1]=K=>d.value.device_type=K),placeholder:"请选择设备类型",style:{width:"100%"}},{default:o(()=>[n(N,{label:"主变压器",value:"main_transformer"}),n(N,{label:"配电变压器",value:"distribution_transformer"}),n(N,{label:"开关柜",value:"switchgear"}),n(N,{label:"断路器",value:"circuit_breaker"}),n(N,{label:"互感器",value:"instrument_transformer"}),n(N,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),n(R,{label:"设备位置",prop:"location",required:""},{default:o(()=>[n(L,{modelValue:d.value.location,"onUpdate:modelValue":l[2]||(l[2]=K=>d.value.location=K),placeholder:"请输入设备位置",clearable:""},null,8,["modelValue"])]),_:1}),n(R,{label:"图像类型",prop:"image_type",required:""},{default:o(()=>[n(ie,{modelValue:d.value.image_type,"onUpdate:modelValue":l[3]||(l[3]=K=>d.value.image_type=K),class:"image-type-group"},{default:o(()=>[n(G,{value:"PRPD"},{default:o(()=>[...l[12]||(l[12]=[k("PRPD图",-1)])]),_:1}),n(G,{value:"UHF"},{default:o(()=>[...l[13]||(l[13]=[k("UHF图",-1)])]),_:1}),n(G,{value:"TEV"},{default:o(()=>[...l[14]||(l[14]=[k("TEV图",-1)])]),_:1}),n(G,{value:"AE"},{default:o(()=>[...l[15]||(l[15]=[k("AE图",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(R,{label:"识别敏感度",prop:"sensitivity"},{default:o(()=>[n(ie,{modelValue:d.value.sensitivity,"onUpdate:modelValue":l[4]||(l[4]=K=>d.value.sensitivity=K),class:"sensitivity-group"},{default:o(()=>[n(G,{value:"low"},{default:o(()=>[...l[16]||(l[16]=[k("低",-1)])]),_:1}),n(G,{value:"medium"},{default:o(()=>[...l[17]||(l[17]=[k("中",-1)])]),_:1}),n(G,{value:"high"},{default:o(()=>[...l[18]||(l[18]=[k("高",-1)])]),_:1})]),_:1},8,["modelValue"]),l[19]||(l[19]=t("div",{class:"sensitivity-help"},[t("small",null,"敏感度越高，检测越精细但可能产生误报")],-1))]),_:1})]),_:1},8,["model"])]),_:1}),n(et,{ref_key:"uploaderRef",ref:e,onFilesChange:O,onFilesClear:w,class:"uploader-section"},null,512),n(re,{class:"control-card",shadow:"hover"},{default:o(()=>[t("div",Ns,[t("div",Os,[a.value.length===0?(g(),$("div",Es,[n(x,{class:"hint-icon"},{default:o(()=>[n(B(Me))]),_:1}),l[20]||(l[20]=t("span",null,"请先上传图像文件",-1))])):(g(),$("div",qs,[n(x,{class:"ready-icon"},{default:o(()=>[n(B(fe))]),_:1}),t("span",null,"已准备 "+h(a.value.length)+" 个文件",1)]))]),n(M,{type:"primary",size:"large",onClick:p,disabled:!S.value,loading:m.value,class:"diagnosis-btn"},{default:o(()=>[m.value?D("",!0):(g(),j(x,{key:0},{default:o(()=>[n(B(Ce))]),_:1})),k(" "+h(m.value?"提交中...":"开始诊断"),1)]),_:1},8,["disabled","loading"])])]),_:1})])]),_:1}),n(ce,{lg:14,md:12,sm:24},{default:o(()=>[t("div",Bs,[n(Ot,{tasks:i.value,"current-task-id":u.value,onTaskSelect:v,onTaskRetry:c,onTaskRemove:r,onTasksClearCompleted:z,class:"task-manager-section"},null,8,["tasks","current-task-id"]),n($s,{result:q.value,onExportResult:U,class:"result-section"},null,8,["result"])])]),_:1})]),_:1})])])}}}),Zs=ae(js,[["__scopeId","data-v-ea0c3e4b"]]);export{Zs as default};
