import{d as A,r as f,c as G,o as K,b as y,t as e,q as t,f as c,ah as s,u as k,aQ as P,C as n,S as W,p as g,H as F,aF as X,F as L,B as I,D as u,br as Y,b4 as Z,e as d,bi as ee}from"./index.js";import{ai as H}from"./index4.js";import{c as te}from"./index8.js";import"./vnode.js";import"./scroll.js";const le={class:"diagnosis-history-page"},ae={class:"record-details"},oe={key:0,class:"drawer-content"},se={style:{"margin-top":"30px"}},ne=A({__name:"DiagnosisHistory",setup(re){const r=f([]),b=f(!1),v=f(""),w=f(!1),i=f(null),x=G(()=>{if(!v.value)return r.value;const o=v.value.toLowerCase();return r.value.filter(l=>l.result.fault_type.toLowerCase().includes(o)||l.result.diagnosis.toLowerCase().includes(o))}),E=()=>{b.value=!0;try{const o=localStorage.getItem("diagnosisHistory");r.value=o?JSON.parse(o):[]}catch{H.error("加载历史记录失败"),r.value=[]}finally{b.value=!1}},M=()=>{te.confirm("确定要清空所有历史记录吗？此操作不可撤销。","警告",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"warning"}).then(()=>{localStorage.removeItem("diagnosisHistory"),r.value=[],H.success("所有历史记录已清空")})},T=o=>{r.value=r.value.filter(l=>l.id!==o),localStorage.setItem("diagnosisHistory",JSON.stringify(r.value)),H.success("该条记录已删除")},q=o=>{i.value=o,w.value=!0},S=o=>o.includes("过热")?"danger":o.includes("放电")?"warning":"info";return K(()=>{E()}),(o,l)=>{const h=s("el-card"),J=s("el-input"),B=s("el-col"),C=s("el-button"),O=s("el-row"),p=s("el-descriptions-item"),V=s("el-descriptions"),m=s("el-table-column"),D=s("el-tag"),Q=s("el-table"),R=s("el-empty"),N=s("el-icon"),U=s("el-alert"),$=s("el-drawer"),j=X("loading");return d(),y("div",le,[e(h,{class:"header-card",shadow:"never"},{default:t(()=>[...l[2]||(l[2]=[c("h1",null,"诊断历史记录",-1),c("p",{class:"page-description"},"查看、搜索和管理所有已保存的故障诊断记录。",-1)])]),_:1}),e(h,{style:{"margin-top":"20px"}},{default:t(()=>[e(O,{gutter:20,justify:"space-between"},{default:t(()=>[e(B,{span:16},{default:t(()=>[e(J,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=a=>v.value=a),placeholder:"按故障类型或诊断详情搜索...","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),_:1}),e(B,{span:8,style:{"text-align":"right"}},{default:t(()=>[e(C,{type:"danger",onClick:M,icon:k(P)},{default:t(()=>[...l[3]||(l[3]=[n(" 清空所有记录 ",-1)])]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(h,{style:{"margin-top":"20px"}},{header:t(()=>[c("span",null,"历史记录列表 ("+u(x.value.length)+")",1)]),default:t(()=>[W((d(),g(Q,{data:x.value,style:{width:"100%"}},{default:t(()=>[e(m,{type:"expand"},{default:t(a=>[c("div",ae,[l[4]||(l[4]=c("h4",null,"诊断输入参数",-1)),e(V,{column:2,border:"",size:"small"},{default:t(()=>[(d(!0),y(L,null,I(a.row.params,(_,z)=>(d(),g(p,{key:z,label:z},{default:t(()=>[n(u(_),1)]),_:2},1032,["label"]))),128))]),_:2},1024)])]),_:1}),e(m,{prop:"result.fault_type",label:"故障类型",width:"180"},{default:t(({row:a})=>[e(D,{type:S(a.result.fault_type)},{default:t(()=>[n(u(a.result.fault_type),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"result.diagnosis",label:"诊断详情","show-overflow-tooltip":""}),e(m,{prop:"timestamp",label:"诊断时间",width:"200"},{default:t(({row:a})=>[n(u(new Date(a.timestamp).toLocaleString()),1)]),_:1}),e(m,{label:"操作",width:"120"},{default:t(({row:a})=>[e(C,{size:"small",type:"primary",text:"",onClick:_=>q(a)},{default:t(()=>[...l[5]||(l[5]=[n("查看",-1)])]),_:1},8,["onClick"]),e(C,{size:"small",type:"danger",text:"",onClick:_=>T(a.id)},{default:t(()=>[...l[6]||(l[6]=[n("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,b.value]]),x.value.length===0?(d(),g(R,{key:0,description:"暂无历史记录或匹配结果"})):F("",!0)]),_:1}),e($,{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=a=>w.value=a),title:"诊断记录详情",direction:"rtl",size:"50%"},{default:t(()=>[i.value?(d(),y("div",oe,[c("h4",null,[e(N,null,{default:t(()=>[e(k(Y))]),_:1}),l[7]||(l[7]=n(" 诊断结果",-1))]),e(V,{column:1,border:""},{default:t(()=>[e(p,{label:"故障类型"},{default:t(()=>[e(D,{type:S(i.value.result.fault_type)},{default:t(()=>[n(u(i.value.result.fault_type),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"置信度"},{default:t(()=>[n(u((i.value.result.confidence*100).toFixed(1))+"%",1)]),_:1}),e(p,{label:"诊断详情"},{default:t(()=>[n(u(i.value.result.diagnosis),1)]),_:1}),e(p,{label:"建议措施"},{default:t(()=>[e(U,{title:i.value.result.recommendation,type:"warning",closable:!1,"show-icon":""},null,8,["title"])]),_:1})]),_:1}),c("h4",se,[e(N,null,{default:t(()=>[e(k(Z))]),_:1}),l[8]||(l[8]=n(" 诊断输入参数",-1))]),e(V,{column:2,border:"",size:"small"},{default:t(()=>[(d(!0),y(L,null,I(i.value.params,(a,_)=>(d(),g(p,{key:_,label:_},{default:t(()=>[n(u(a),1)]),_:2},1032,["label"]))),128))]),_:1})])):F("",!0)]),_:1},8,["modelValue"])])}}}),_e=ee(ne,[["__scopeId","data-v-0d0a93cc"]]);export{_e as default};
