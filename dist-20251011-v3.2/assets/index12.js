import{r as a,a as l}from"./index11.js";function f(t){const e={raw_report:t,parsed_success:!1,recommendations:[]};try{console.log(t);const s=t.match(/\*\*故障等级\*\*：(.*?)(?:\n|$)/);if(s){e.severity=s[1].trim();const n={正常:1,注意:2,警告:3,严重:4,危急:5,一般:2};e.severity_level=n[e.severity]||0}const o=t.match(/\*\*故障类型\*\*：(.*?)(?:\n|$)/);o&&(e.fault_type=o[1].trim());const i=[t.match(/\*\*故障诊断依据\*\*：(.*?)(?=\n\n)/),t.match(/高能电弧放电/),t.match(/([^。]*放电[^。]*)/),t.match(/([^。]*故障[^。]*)/),t.match(/DPM[^，]*诊断为[^，。]*/),t.match(/杜瓦尔五边形法[^，]*诊断为[^，。]*/)];for(const n of i)if(n&&n[0]){e.main_diagnosis=n[0].trim();break}const m=[/[1-9]\.\s*\*\*([^*]+)\*\*/g,/[1-9]\.\s*([^：\n]+)[:：]/g,/必须执行的安全措施[^：]*[:：]\s*([\s\S]*?)(?=\n\n|\n[#1-9])/];for(const n of m){const c=Array.from(t.matchAll(n));if(c.length>0){e.recommendations=c.map(r=>r[1]?.trim().replace(/\*\*/g,"")||"").filter(r=>r.length>0);break}}if(e.recommendations?.length===0){const n=["立即停运与隔离","安全警示与区域封锁","接地保护","消防准备","人员防护"];e.recommendations=n.filter(c=>t.includes(c))}e.parsed_success=!!(e.severity||e.fault_type||e.main_diagnosis)}catch(s){console.error("解析文本时出错:",s),e.parsed_success=!1}return e}function h(t){const e=[];return t.severity&&e.push(`严重性: ${t.severity}`),t.fault_type?e.push(`故障类型: ${t.fault_type}`):t.main_diagnosis&&e.push(`诊断结果: ${t.main_diagnosis}`),t.recommendations&&t.recommendations.length>0&&e.push(`主要建议: ${t.recommendations.slice(0,2).join(", ")}`),e.join(" | ")}function u(t){const e={},s=t.match(/等级[：:]\s*(\d+)\/(\d+)/);s&&(e.severity_level=parseInt(s[1]),e.max_level=parseInt(s[2]));const o=t.match(/诊断时间[：:]\s*([^\n]+)/);o&&(e.diagnosis_time=o[1].trim());const i=t.match(/设备ID[：:]\s*([^\n]+)/);return i&&(e.device_id=i[1].trim()),e}const d=t=>a.post("/v1/article2mindmap",t),v=t=>a.post("https://fdsu.bd.kxsz.net:9443/api/v1/mindmap2ftree",t),y=t=>l.post("https://fdsu.bd.kxsz.net:9443/webhook/ftree",t).then(e=>{const s=e.data.report,o=f(s);return{raw_text:s,parsed_data:o,summary:h(o),metrics:u(s),input_params:t}});export{v as a,d as c,y as n};
